@page
@model DemoRazorPages_ShopDB.Pages.Products.DetailsModel

@{
    ViewData["Title"] = "Product Details";
}

<div class="container">
    <h2>Product Details</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th>Product ID:</th>
                            <td>@Model.Product.ProductId</td>
                        </tr>
                        <tr>
                            <th>Product Name:</th>
                            <td>@Model.Product.ProductName</td>
                        </tr>
                        <tr>
                            <th>Category:</th>
                            <td>@Model.Product.Category?.CategoryName</td>
                        </tr>
                        <tr>
                            <th>Price:</th>
                            <td>@Model.Product.Price.ToString("C2")</td>
                        </tr>
                        <tr>
                            <th>Quantity In Stock:</th>
                            <td>@Model.Product.Quantity</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>Thêm vào giỏ hàng</h5>
            </div>
            <div class="card-body">
                <form method="get" asp-page="/Carts/AddToCart">
                    <input type="hidden" name="productId" value="@Model.Product.ProductId" />

                    <div class="mb-3">
                        <label for="cartId" class="form-label">Chọn giỏ hàng</label>
                        <select id="cartId" name="cartId" class="form-select" required>
                            <option value="">-- Chọn giỏ hàng --</option>
                            @foreach (var cart in Model.Carts)
                            {
                                <option value="@cart.CartId">Giỏ hàng #@cart.CartId (@cart.CreatedDate.ToString("dd/MM/yyyy"))</option>
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="quantity" class="form-label">Số lượng</label>
                        <input type="number" id="quantity" name="quantity" class="form-control" value="1" min="1" max="@Model.Product.Quantity" required />
                    </div>

                    <div class="d-flex">
                        <button type="submit" class="btn btn-primary">Thêm vào giỏ hàng</button>
                        <a href="/Carts/Index" class="btn btn-outline-secondary ms-2">Xem giỏ hàng</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <h3 class="mt-4">Orders Containing This Product</h3>

    @if (Model.OrderDetails != null && Model.OrderDetails.Any())
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Order Date</th>
                    <th>Customer</th>
                    <th>Quantity Ordered</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var detail in Model.OrderDetails)
                {
                    <tr>
                        <td>@detail.OrderId</td>
                        <td>@detail.Order?.OrderDate?.ToString("yyyy-MM-dd")</td>
                        <td>@detail.Order?.Customer?.CustomerName</td>
                        <td>@detail.Quantity</td>
                        <td>
                            <a asp-page="/Orders/Details" asp-route-id="@detail.OrderId" class="btn btn-sm btn-info">View Order</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>This product has not been ordered yet.</p>
    }

    <div class="mt-3">
        <a asp-page="./Edit" asp-route-id="@Model.Product.ProductId" class="btn btn-primary">Edit</a>
        <a asp-page="./List" class="btn btn-secondary">Back to List</a>
        <a asp-page="/Cart/Index" class="btn btn-success">View Cart</a>
    </div>
</div>

<style>
    .card {
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    th {
        width: 40%;
    }

    h3 {
        margin-top: 30px;
        margin-bottom: 15px;
    }
</style>